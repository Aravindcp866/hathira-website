{"version":3,"file":"VisualEditingComponent2.js","sources":["../../src/react-router/VisualEditingComponent.tsx"],"sourcesContent":["import {startTransition, useEffect, useRef, useState} from 'react'\nimport {useLocation, useNavigate, useRevalidator} from 'react-router'\nimport {type HistoryAdapterNavigate, type HistoryRefresh, type VisualEditingOptions} from '../types'\nimport {enableVisualEditing} from '../ui/enableVisualEditing'\n\n/**\n * @public\n */\nexport interface VisualEditingProps extends Omit<VisualEditingOptions, 'history' | 'refresh'> {\n  /**\n   * @deprecated The history adapter is already implemented\n   */\n  history?: never\n  /**\n   * The refresh API allows smarter refresh logic than the default `location.reload()` behavior.\n   * You can call the refreshDefault argument to trigger the default refresh behavior so you don't have to reimplement it.\n   */\n  refresh?: (\n    payload: HistoryRefresh,\n    refreshDefault: () => false | Promise<void>,\n  ) => false | Promise<void>\n}\n\nexport default function VisualEditingComponent(props: VisualEditingProps): null {\n  const {components, refresh, zIndex} = props\n\n  const navigateRemix = useNavigate()\n  const navigateRemixRef = useRef(navigateRemix)\n  const [navigate, setNavigate] = useState<HistoryAdapterNavigate | undefined>()\n  const revalidator = useRevalidator()\n  const [revalidatorPromise, setRevalidatorPromise] = useState<(() => void) | null>(null)\n  const [revalidatorLoading, setRevalidatorLoading] = useState(false)\n\n  useEffect(() => {\n    navigateRemixRef.current = navigateRemix\n  }, [navigateRemix])\n  useEffect(() => {\n    if (revalidatorPromise && revalidator.state === 'loading') {\n      startTransition(() => setRevalidatorLoading(true))\n    } else if (revalidatorPromise && revalidatorLoading && revalidator.state === 'idle') {\n      revalidatorPromise()\n      startTransition(() => {\n        setRevalidatorPromise(null)\n        setRevalidatorLoading(false)\n      })\n    }\n  }, [revalidatorLoading, revalidator.state, revalidatorPromise])\n  useEffect(() => {\n    const disable = enableVisualEditing({\n      components,\n      zIndex,\n      refresh: (payload) => {\n        function refreshDefault() {\n          if (payload.source === 'mutation' && payload.livePreviewEnabled) {\n            return false\n          }\n          return new Promise<void>((resolve) => {\n            revalidator.revalidate()\n            setRevalidatorPromise(() => resolve)\n          })\n        }\n        return refresh ? refresh(payload, refreshDefault) : refreshDefault()\n      },\n      history: {\n        subscribe: (_navigate) => {\n          setNavigate(() => _navigate)\n          return () => setNavigate(undefined)\n        },\n        update: (update) => {\n          if (update.type === 'push' || update.type === 'replace') {\n            navigateRemixRef.current(update.url, {\n              replace: update.type === 'replace',\n            })\n          } else if (update.type === 'pop') {\n            navigateRemixRef.current(-1)\n          }\n        },\n      },\n    })\n    return () => disable()\n  }, [components, refresh, revalidator, zIndex])\n\n  const location = useLocation()\n  useEffect(() => {\n    if (navigate) {\n      navigate({\n        type: 'push',\n        url: `${location.pathname}${location.search}${location.hash}`,\n      })\n    }\n  }, [location.hash, location.pathname, location.search, navigate])\n\n  return null\n}\n"],"names":["VisualEditingComponent","props","$","_c","components","refresh","zIndex","navigateRemix","useNavigate","navigateRemixRef","useRef","navigate","setNavigate","useState","revalidator","useRevalidator","revalidatorPromise","setRevalidatorPromise","revalidatorLoading","setRevalidatorLoading","t0","t1","current","useEffect","t2","t3","state","startTransition","t4","t5","disable","enableVisualEditing","payload","refreshDefault","source","livePreviewEnabled","Promise","resolve","revalidate","history","subscribe","_navigate","undefined","update","type","url","replace","location","useLocation","t6","t7","hash","pathname","search"],"mappings":"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"}